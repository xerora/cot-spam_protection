<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><style>html {
    margin: 0;
    padding: 0; }

body {
    background-color: white;
    border-radius: 3px;
    border: 3px solid #EEE;
    box-shadow: inset 0 0 0 1px #CECECE;
    font-family: Helvetica,arial,sans-serif;
    font-size: 14px;
    line-height: 1.6;
    width: 975px;
    padding: 30px;
    margin: 2em auto; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4;
  text-decoration: none; }
a:hover {
  text-decoration: underline; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("https://a248.e.akamai.net/assets.github.com/assets/primer/markdown/dirty-shade-0e7d81b119cc9beae17b0c98093d121fa0050a74.png") repeat-x 0 0;
  border: 0 none;
  color: #ccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  border-collapse: collapse; border-spacing: 0; padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }


.markdown-body code,.markdown-body tt{margin:0 2px;padding:0px 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}
.markdown-body pre>code{margin:0;padding:0;white-space:pre;border:none;background:transparent}
.markdown-body .highlight pre,.markdown-body pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}
.markdown-body pre code,.markdown-body pre tt{background-color:transparent;border:none}
.highlight{background:#ffffff}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .gd .x{color:#000000;background-color:#ffaaaa}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .gi .x{color:#000000;background-color:#aaffaa}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#d14}
.highlight .na{color:#008080}
.highlight .nb{color:#0086B3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:#008080}
.highlight .ni{color:#800080}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:#000080}
.highlight .nv{color:#008080}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#d14}
.highlight .sc{color:#d14}
.highlight .sd{color:#d14}
.highlight .s2{color:#d14}
.highlight .se{color:#d14}
.highlight .sh{color:#d14}
.highlight .si{color:#d14}
.highlight .sx{color:#d14}
.highlight .sr{color:#009926}
.highlight .s1{color:#d14}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:#008080}
.highlight .vg{color:#008080}
.highlight .vi{color:#008080}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
.type-csharp .highlight .k{color:#0000FF}
.type-csharp .highlight .kt{color:#0000FF}
.type-csharp .highlight .nf{color:#000000;font-weight:normal}
.type-csharp .highlight .nc{color:#2B91AF}
.type-csharp .highlight .nn{color:#000000}
.type-csharp .highlight .s{color:#A31515}
.type-csharp .highlight .sc{color:#A31515}


</style></head><body><h2>What this plugin does</h2>

<ul>
<li>Filters comment, forum and other spam with your choice of services (Akismet, Defensio, Typepad Anti-Spam). Comment and forum spam filtering is disabled by default. ( It is not recommended to use non-custom adapters for filtering if you use plugins that alter the extension you are filtering spam on. This could have unexpected results unless you know the specifics.)</li>
<li>Provides an administration tool to manage items marked as spam.</li>
<li>Allows you to filter spam in your extensions.</li>
<li>Add your own section adapters to enable your extensions to use the spam moderation queue when filtering spam.</li>
</ul><h2>Installation</h2>

<p><em>Always backup your database as a precaution</em></p>

<ol>
<li>Decide which spam service you wish to use. Register at the service you choose to use and obtain an API key.

<ul>
<li>Akismet: <a href="http://akismet.com/">http://akismet.com</a>
</li>
<li>Defensio: <a href="http://defensio.com/">http://defensio.com</a> - Defensio has been having instability issues and has been down for a large amount of time as of March 5th, 2013. Spam filtering won't work when the service is down but will not effect your site.</li>
<li>Typepad Anti-Spam: <a href="http://antispam.typepad.com/">http://antispam.typepad.com</a>
</li>
</ul>
</li>
<li>Download, unpack and upload the spam_protection plugin folder to your plugin directory.</li>
<li>Install the plugin in the administration panel.</li>
<li>Go into the plugin's configurations in the admin panel and select your spam service and enter your API key.</li>
<li>Check to see that everything is configured to your preference.</li>
<li>The rest is up to your spam service and you can find all spam items caught in Administration -&gt; Other -&gt; Spam Protection</li>
</ol><h2>Adding spam filtering to your extensions</h2>

<p>An example of what it would look like to add spam filtering to your extension:</p>

<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nx">cot_plugin_active</span><span class="p">(</span><span class="s1">'spam_protection'</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">require_once</span> <span class="nx">cot_incfile</span><span class="p">(</span><span class="s1">'spam_protection'</span><span class="p">,</span> <span class="s1">'plug'</span><span class="p">);</span>
    <span class="nv">$spam_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nv">$msg</span><span class="p">[</span><span class="s1">'text'</span><span class="p">],</span>
        <span class="s1">'authorname'</span> <span class="o">=&gt;</span> <span class="nv">$usr</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
        <span class="s1">'authoremail'</span> <span class="o">=&gt;</span> <span class="nv">$usr</span><span class="p">[</span><span class="s1">'profile'</span><span class="p">][</span><span class="s1">'user_email'</span><span class="p">],</span>
        <span class="s1">'authorid'</span> <span class="o">=&gt;</span> <span class="nv">$usr</span><span class="p">[</span><span class="s1">'id'</span><span class="p">],</span>
        <span class="s1">'authorip'</span> <span class="o">=&gt;</span> <span class="nv">$usr</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">],</span>
        <span class="s1">'date'</span> <span class="o">=&gt;</span> <span class="nv">$sys</span><span class="p">[</span><span class="s1">'now'</span><span class="p">],</span>
        <span class="s1">'section'</span> <span class="o">=&gt;</span> <span class="s1">'guestbook'</span><span class="p">,</span>
        <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'guestbook'</span> <span class="o">=&gt;</span> <span class="nv">$msg</span>
        <span class="p">),</span> 
    <span class="p">);</span>
    <span class="nv">$spam_check_result</span> <span class="o">=</span> <span class="nx">spam_protection_check</span><span class="p">(</span><span class="nv">$spam_data</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$spam_check_result</span><span class="p">[</span><span class="s1">'is_spam'</span><span class="p">])</span>
    <span class="p">{</span>
        <span class="c1">// Item was returned as spam</span>
        <span class="nx">spam_protection_queue_add</span><span class="p">(</span><span class="nv">$spam_data</span><span class="p">);</span> <span class="c1">// Add to the moderation queue if you want. Not required.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>See <strong>spam_protection_check</strong> below for more options to pass.</p>

<h2>Available Tags</h2>

<h3>forums.posts.tpl</h3>

<h6>Block: FORUMS_POSTS_ROW</h6>

<ul>
<li>
<code>{SP_MARK_AS_SPAM_URL}</code>: The URL for for sending false negatives back to the spam service and deleting the item.</li>
<li>
<code>{SP_MARK_AS_SPAM_LINK}</code>: A resource that is formatted into a link for marking an item as spam.</li>
</ul><h3>comments.tpl</h3>

<h6>Block: COMMENTS_ROW</h6>

<ul>
<li>
<code>{SP_MARK_AS_SPAM_URL}</code>: The URL for for sending false negatives back to the spam service and deleting the item.</li>
<li>
<code>{SP_MARK_AS_SPAM_LINK}</code>: A resource that is formatted into a link for marking an item as spam.</li>
</ul><h2>Section adapters</h2>

<p>Section adapters allow you to add your own spam filtered items to the moderation queue. </p>

<p>To enable queue moderation on your custom filtered items, simply:</p>

<ul>
<li>Create a file named after the section you assigned your items to (e.g <code>'section' =&gt; 'guestbook'</code> would be <code>guestbook.php</code>) and place it
in adapters/sections. Go to the admin panel and clear the internal cache on <code>sp_available_sections</code>. In the moderation queue, you will now see the section name along with the other sections and you will be able to view items that were found to be spam for that section.</li>
<li>To be able to take action on the items in the queue, you must define the functions <code>spam_protection_queue_ham(array $item, $service, array $data)</code> for the Mark as Ham action and <code>spam_protection_queue_spam(array $item, $service, array $data)</code> for the Mark as Spam action in your adapter. You will need to write how you want to deal with an item when you mark it for an action inside the functions. Items will be ran through these functions one at a time. Refer to the "Available callback functions" section in the README for further information on possible options.</li>
</ul><p>You can refer to the <code>comments.php</code> adapter as it is a simple example.</p>

<h2>Available callback functions in section adapters</h2>

<p>A list of functions that will get used at the time you mark an item for spam or ham in the moderation queue if defined. </p>

<h4>spam_protection_queue_ham(array $item, $service, array $data)</h4>

<p>Used on each item one at a time when you use the action 'Mark as Ham' in the moderation queue.</p>

<ul>
<li>
<code>$item</code>: An array of the spam_protection table row data for the item.</li>
<li>
<code>$service</code>: The service object that contains the spam data already setup.</li>
<li>
<code>$data</code>: An array of data from sp_data row in spam_protection. Contains data that was with held when item was sent to spam queue.</li>
</ul><h4>spam_protection_queue_spam(array $item, $service, array $data)</h4>

<p>Used on each item one at a time when you use the action 'Mark as Spam' in the moderation queue. </p>

<ul>
<li>
<code>$item</code>: An array of the spam_protection table row data for the item.</li>
<li>
<code>$service</code>: The service object that contains the spam data already setup.</li>
<li>
<code>$data</code>: An array of data from sp_data row in spam_protection. Contains data that was withheld when item was sent to spam queue.</li>
</ul><h4>spam_protection_queue_after($type)</h4>

<p>Ran after the whole queue is marked. </p>

<ul>
<li>
<code>$type</code>: Either 'spam' or 'ham'</li>
</ul><h4>spam_protection_queue_before($type)</h4>

<p>Ran before the queue is marked. </p>

<ul>
<li>
<code>$type</code>: Either 'spam' or 'ham'</li>
</ul><h4>spam_protection_check_data($type, $data)</h4>

<p>Ran before the item is marked and can be used to validat<br>
e/change the data before being marked.</p>

<ul>
<li>
<code>$type</code>: Either 'spam' or 'ham'.</li>
<li>
<code>$data</code>: An array of spam data from the spam_protection database table for the item being marked.</li>
</ul><h2>Available service adapter functions</h2>

<p>Functions that are available from any spam service that you use and can be used anywhere you include this plugin.</p>

<h4>spam_protection_service_connection()</h4>

<p>Used to create a new service object for use with the spam service</p>

<ul>
<li>
<code>return</code>: The service object that has been created.</li>
</ul><h5>spam_protection_service_setup($service, array $data)</h5>

<p>Used to load the service object with spam data.</p>

<ul>
<li>
<code>$service</code>: The service object</li>
<li>
<code>$data</code>: An array of the spam data to be checked / used</li>
<li>
<code>return</code>: Service object with spam data loaded</li>
</ul><h4>spam_protection_service_validate_key([$service])</h4>

<p>Validate the spam service API key entered for the service.</p>

<ul>
<li>
<code>$service</code>: <em>optional</em>, A service object. One will be created if not passed.</li>
<li>
<code>return</code>: A boolean whether the key is valid or not.</li>
</ul><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nx">spam_protection_service_validate_key</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// API key is valid</span>
<span class="p">}</span>
<span class="k">else</span> 
<span class="p">{</span>
    <span class="c1">// API key is invalid</span>
<span class="p">}</span>
</pre></div>

<h4>spam_protection_service_submit_ham($service)</h4>

<p>Submit false positives to the spam service in order to make it more knowledgeable in the future.</p>

<ul>
<li>
<code>$service</code>: A service object with spam data loaded into it.</li>
<li>
<code>return</code>: A boolean whether the submit was completed or not.</li>
</ul><div class="highlight"><pre><span class="nv">$service</span> <span class="o">=</span> <span class="nx">spam_protection_service_connection</span><span class="p">();</span>
<span class="nv">$service</span> <span class="o">=</span> <span class="nx">spam_protection_service_setup</span><span class="p">(</span><span class="nv">$service</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'text'</span><span class="p">],</span>
    <span class="s1">'authorname'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">],</span>
    <span class="s1">'authorid'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'authorid'</span><span class="p">],</span>
    <span class="s1">'authorip'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'authorip'</span><span class="p">],</span>
    <span class="s1">'date'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span>
<span class="p">));</span>
<span class="nx">spam_protection_service_submit_ham</span><span class="p">(</span><span class="nv">$service</span><span class="p">);</span>
</pre></div>

<h4>spam_protection_service_submit_spam($service)</h4>

<p>Submit false negatives to the spam service in order to make it more knowledgeable in the future.</p>

<ul>
<li>
<code>$service</code>: A service object with spam data loaded into it.</li>
<li>
<code>return</code>: A boolean whether the submit was completed or not.</li>
</ul><div class="highlight"><pre><span class="nv">$service</span> <span class="o">=</span> <span class="nx">spam_protection_service_connection</span><span class="p">();</span>
<span class="nv">$service</span> <span class="o">=</span> <span class="nx">spam_protection_service_setup</span><span class="p">(</span><span class="nv">$service</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'text'</span><span class="p">],</span>
    <span class="s1">'authorname'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">],</span>
    <span class="s1">'authorid'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'authorid'</span><span class="p">],</span>
    <span class="s1">'authorip'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'authorip'</span><span class="p">],</span>
    <span class="s1">'date'</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span>
<span class="p">));</span>
<span class="nx">spam_protection_service_submit_spam</span><span class="p">(</span><span class="nv">$service</span><span class="p">);</span>
</pre></div>

<h4>spam_protection_queue_add($data)</h4>

<p>Send spam data to moderation queue for further review. Items marked as spam can still be false positive.</p>

<ul>
<li>
<code>$data</code>: An array of data. See <strong>spam_protection_check</strong> for options for <code>$data</code>
</li>
</ul><h4>spam_protection_queue_remove($id)</h4>

<p>Remove item from moderation queue. Just deletes the record from the spam_protection database table.</p>

<ul>
<li>
<code>$id</code>: The <code>sp_id</code> for the item in spam_protection database table.</li>
</ul><h4>spam_protection_check($data)</h4>

<p>Send data to the spam service for validation.</p>

<ul>
<li>
<p><code>$data</code>: An array of data to validate against.</p>

<p><strong>Options</strong> </p>

<ul>
<li>
<code>content</code>: The body of text you need to review.</li>
<li>
<code>authorname</code>: The name of the author.</li>
<li>
<code>authoremail</code>: The email address of the author.</li>
<li>
<code>authorid</code>: The Cotonti user id of the author.</li>
<li>
<code>authorip</code>: The IP address of the author.</li>
<li>
<code>referrer</code>: The request referrer.</li>
<li>
<code>date</code>: The current date timestamp at the time of the posting.</li>
<li>
<code>section</code>: A simple name or plugin name that is a "file safe" name. This will be your section adapter name if you send the item to the moderation queue.</li>
<li>
<code>subsection</code>: Provide some sort of unqiue identifier for taking special actions on an item in a section when marking as ham/spam in the moderation queue. (eg. section is 'forum' and subsection could be 'post')</li>
<li>
<code>data</code>: An array in which you store data that is withheld from being submitted into the database. This data can be used to restore your item when you mark it as ham in the moderation queue.</li>
</ul>
</li>
<li><p><code>return</code>: An array with a key 'is_spam' that is a boolean stating whether item is spam or not.</p></li>
</ul><div class="highlight"><pre><span class="nv">$spam_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'blahblah viagra blahblah'</span><span class="p">,</span>
    <span class="s1">'authorname'</span> <span class="o">=&gt;</span> <span class="s1">'viagra-user'</span><span class="p">,</span>
    <span class="s1">'authoremail'</span> <span class="o">=&gt;</span> <span class="s1">'viagra@drugs.com'</span>
<span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">spam_protection_check</span><span class="p">(</span><span class="nv">$spam_data</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="s1">'is_spam'</span><span class="p">])</span>
<span class="p">{</span>
    <span class="c1">// is spam</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">// not spam</span>
<span class="p">}</span>
</pre></div>

<h2>Complete removal</h2>

<p>The following is to completely remove this plugin.</p>

<ol>
<li>Uninstall the plugin in the Cotonti plugin administration</li>
<li>Delete the plugin folder "spam_protection" in your plugins folder</li>
<li>Delete the database table ( usually cot_spam_protection ) in phpMyAdmin or the likes</li>
</ol><h2>Notes</h2>

<ul>
<li>You can NOT enable multiple services for filtering an item. You can only have one spam filtering service running.</li>
<li>
<p>You can rename the spam_protection database table by defining it in your config.php:</p>

<p><code>$db_spam_protection = 'cot_spam_protection';</code></p>

<p>Note: Make sure the table exists. You must ensure you renamed your database table if you have already installed the plugin.<br>
This plugin creates the database table when installed through the administration panel. You can just reinstall the plugin after<br>
defining the new table name in the config but ensure the old table is removed as it is not needed.</p>
</li>
<li><p>Spam filtering is disabled when NO API key is present in the plugin configuration. Your site will continue working as normal if your API key is not present or not valid, but spam services will not work.</p></li>
</ul></body></html>